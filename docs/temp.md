## PR概要
- 簡易的なoff-target 計算の実装
- CRISPR directへのリンクを作成する関数を実装
- 最終的な出力となる dfに情報を足した
- cli　のオプションの調整

## 議論したいこと
### offtarget 計算を行う関数の正しさ、計算速度やメモリ消費に関して
### 出力について
- 現在の出力
    - 遺伝子名　
    - 標的エキソンの情報（位置、長さなど）
    - そのsgRNAを組んだBEの情報(PAM, windowなど)
    - sgRNAの情報(配列,狙っているサイトの情報、位置)
- 問題だと思っていること
    - 標的遺伝子と標的エキソンの位置は入っている。しかし、どの転写産物でskipされていて、どの転写産物でされていないといった情報がぱっと見で分かりにくい
    - エキソン番号を入れるにしても、skipが生じている場合などは、転写産物間でエキソン番号のつき方が違う
    - ユーザーは詳しい人だと想定しているが、それでも、入力がエキソンidではなく、遺伝子名やidである + 出力がエキソンidではないことを考えると、ただ座標だけ出されてもわかりにくいのでは？
    - 各遺伝子ごとにエキソン位置の構成がわかるとサマリー画像があると良いのでは？
    - 次はBED形式で 標的遺伝子のトランスクリプト一覧、sgRNA、を出力できるように改良します (IGVに投げられるように)


## 各ファイルの変更点
### for_cli_setting.py
- CRISPR direct でofftarget site を計算するには、アセンブリ名の入力が必要である。ユーザーに入力させたアセンブリ名がCRISPR directにサポートされているかを調べ、サポート外であれば警告を表示する
- 警告ログの出力のためにloggingを導入

### main.py
- ショートオプションとロングオプションのルールがunix cliの一般的な規則に従うように変更
    - ショートオプションが用意できるものは用意
    - ロングオプションも全体的にシンプルに変えた
- 新たに実装したモジュールを実行するように変更した

### offtarget_scorer.py
- CRISPR directへのリンクを作成する関数を実装
    - PAM + 20bp を入力配列にした。web app上で表示されるsgRNAは一つだけになるはず
    - ユーザーが入力したアセンブリ名も受け取ってurlに格納する
- PAM + 20mer 完全一致を検索するシンプルな関数を実装
    - なるべくメモリ効率を改善するために、1染色体づつ計算し、いらなくなった配列は除去
    - 肯定先読みを使って検索したいが、各染色体でかなりの回数正規表現オブジェクトを呼び出すため、先にcompileするようにした

### output_formatter.py
- 今までは 1エキソン(複数のsgRNA) - 1行という構成でデータを扱ってきたので、explodeして 1sgrna - 1行に
- acceptor, donorは今まで site という列を作って格納するのではなく、acceptor_sequence, donor_sequence というように、列名に付加して管理していた。(1エキソン-1行の名残)
    - 1sgrna-1行にするときに都合が悪い(列名が異なるままだと、縦方向にconcatしにくい)ため、site という列にacceptor or donor を格納するように変更
    - そもそもacceptor, donor 配列をユーザーに渡す意味はあまりないかもしれない
- 各行のsgrnaに、それがどのBEと対応するかの情報を付加
- 一度データフレームbedtoolsに通しているため、BED化に際して欠落した遺伝子の情報などを再び付加
    - 本当は最初からtidy形式で管理すべきだった。今変更すると、かなり大規模な変更が必要になるので、今回は修正を見送り
- UUID列が各エキソンではなく、各sgRNA固有になるように更新

### refflat.preprocessor.py
- 各エキソンが、utrなのか、完全にcdsに含まれるのか、一部だけcdsに含まれるかを判定する関数を実装
### sgrna_designer.py
- CRISPR directにはPAM+20bpを入力にしたいが、今までは20bp部分しか出力していなかったので、PAM+20bpとなるような形で出力するように変更
- 最終出力の調整で、今までは無理やりconcat, drop_duplicateしていたので、必要な列も抜け落ちていた。それを修正
- 最終出力を dict{BEname: sgRNA_df}とする関数を追加
    - 後でdfを操作しやすくするため

### script/
- offtarget_scorer.pyと output_formatter.pyの実行用ファイルの追加
- cds, utr 情報をアノテーションする関数の実装に伴い、run_refflat_preprocessor.pyに該当の関数を追加

### test/
- offtarget_scorer.py とoutput_formatter.pyのテストファイルを追加した
